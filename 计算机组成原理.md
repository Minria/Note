﻿﻿﻿﻿

﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿# 计算机概述

## 计算机硬件组成

<font size=4>**早期的冯·诺伊曼机**</font>

1. 计算机硬件系统由运算器、存储器、控制器、输入设备和输出设备5大部件组成
2. 指令和数据以同等地位存储在存储器中，并可按地址寻访
3. 指令和数据均用二进制代码表示
4. 指令由操作码和地址码组成，操作码指出操作的类型，地址码指出操作数的地址
5. 指令在存储器内按顺序存放。通常，指令是顺序执行的，在特定条件下可根据运算结果或根据设定的条件改变执行顺序
6. 早期的冯·诺依曼机以运算器为中心，输入／输出设备通过运算器与存储器传送数据。 典型的冯·诺依曼计算机结构如图1.1所示

> "存储程序"的概念是指将指令以代码的形式事先输入计算机的主存储器，然后按其在存储器中的首地址执行程序的笫一条指令，以后就按该程序的规定顺序执行其他指令，直至 程序执行结束。

![](https://gitee.com/wang-fuming/dawning/raw/master/202110071440613.png)

# 数据表示和运算

## 数制与编码

### 进位计数制及其相互转换

采用二进制原因

1. 二进制只有两种状态， 使用有两个稳定状态的物理器件就可以表示二进制数的每一位， 制造成本比较低， 例如用高低电平或电荷的正负极性都可以很方便地表示 0 和 1 。
2)	二进制位l和0正好与逻辑值 “真” 和 “假 ” 对应， 为计算机实现逻辑运算和程序中的逻辑判断提供了便利条件。
3. 二进制的编码和运算规则都很简单，通过逻辑门电路能方便地实现算术运算。

进位计数法，以及不同进位数转化不在赘述。

### 真值和机器数

生活中用“+”，“-”来区分正负数

在机器中首位1表示负数，0表示正数

0，101表示5；1，101表示-5

### BCD码

1. 8421码
2. 余3码
3. 2421码

### 字符与字符串

### 校验码

## 定点数的表示和运算

### 定点数的表示

#### 有符号数和无符号数

无符号数。 指整个机器字长的全部二进制位均为数值位， 没有符号位， 相当千数的绝对值。 若机器字长为 8 位， 则数的表示范围为 0~$2^2$ -1, 即 0~255。

有符号数。 在机器中， 数的 “ 正”“负 ” 号是无法识别的， 有符号数用 “0"表示 “正号， 用 “1"表示 “ 负 ” 号， 从而将符号也数值化， 并通常约定二进制数的最高位为符 号位， 即将符号位放在有效数字的前面， 组成有符号数。

#### 机器数的定点表示

##### 定点小数

纯小数，约定小数点的位置在符号位之后，有效数值部分最高位之前。

X=X<sub>0</sub>X<sub>1</sub>X<sub>2</sub>X<sub>3</sub>X<sub>4</sub>X<sub>n</sub>

其中X0是符号位，在X0和X1之前隐藏一个小数点

##### 定点整数

X=X<sub>0</sub>X<sub>1</sub>X<sub>2</sub>X<sub>3</sub>X<sub>4</sub>X<sub>n</sub>

X<sub>0</sub>表示符号位，在X<sub>n</sub>后面隐藏一个小数点

##### 原反补移码

移码常用来表示浮点数的阶码。它只能表示整数。

移码中零的表示唯一

一个真值的移码和补码仅差一个符号位

移码全0 时，对应真值的最小值－2勹移码全l时，对应真值的最大值2 n-1。

移码保待了数据原有的大小顺序，移码大真值就大，移码小真值就小。

#### 定点数的运算

##### 原码定点数加减运算

加法规则：先判断符号位，如果相同，则绝对值相加。如果不相同，做减法，绝对值大的数减去绝对值小的数。

减法规则：先将减数符号位取反，然后将被减数与减数按原码加法运算。

##### 补码定点数加减运算

参与运算的两个操作数均用补码表示。

2)	按二进制运算规则运算，逄二进 一。
3)	符号位与数值位按同样规则一起参与运算，符号位运算产生的进位要丢掉，结果的符号 位由运算得出。
4)	补码加减运算依据 下面的公式进行。当参加 运算的数是定点小数时，模M = 2;当参加 运算的数是定点整数时，模M= 

[A+ B]<sub>补</sub>＝［A]<sub>补</sub> ＋［ B]<sub>补</sub>   (modM)
[A-  B]<sub>补</sub>＝［A]<sub>补</sub> ＋［-B]<sub>补</sub>   (modM)

若做加法，则两数的补码直接相加；若做减法，则将被减数与减数的机器负数 相加。

设机器字长8位，其中符号位1位，A=15，B=24，求[A+B]<sub>补</sub>，[A-B]<sub>补</sub>

A=00001111   B=00011000

A<sub>补</sub>=0000111 B<sub>补</sub>=00011000    [-B]<sub>补</sub>=11101000

[A+B]<sub>补</sub>=00001111+00011000=00100111------->对应真值39

[A-B]<sub>补</sub>=[A]<sub>补</sub>+[-B]<sub>补</sub>=00001111+11101000=11110111--->原码10001001--->真值-9

##### 符号拓展

正数：添加0

负数：原码添加0，补码添加1（对于整数），添加0（对于小数部分），反码添加1

##### 溢出及判断

**单一符号位**

设A的符号为A<sub>s</sub>，B的符号为B<sub>s</sub>，运算结果符号位S<sub>s</sub>

V=A<sub>s</sub>B<sub>s</sub>$\overline{\text{$S_s$}}$+$\overline{\text{$A_s$}}$$\overline{\text{$B_s$}} $S <sub>s</sub>

V=0,没有溢出；V=1，有溢出

**双符号位**

双符号位法也称模4补码。 

运算结果的两个符号位Sslss2 相同， 表示未溢出；

运算结果的两个符号位S<sub>s1</sub>S<sub>s2</sub> 不同， 表示溢出，此时最高位符号位代表真正的符号。

S<sub>s1</sub>S<sub>s2</sub> =00: 表示结果为正数， 无溢出。

S<sub>s1</sub>S<sub>s2</sub> =01:表示结果正溢出。

S<sub>s1</sub>S<sub>s2</sub> =10:表示结果负溢出。

S<sub>s1</sub>S<sub>s2</sub> =11:表示结果为负数， 无溢出。

**一位符号位根据数据位**

符号位进位C<sub>s</sub>和最高数位的进位C<sub>1</sub>相同，则说明没有溢出。

##### 定点数的乘法运算

**原码一位乘法**

原码一位乘法的特点是符号位与数值位是分开求的，乘积符号由两个数的符号位 “异或“形成， 而乘积的数值部分则是两个数的绝对值相乘之积。

[X]<sub>原</sub> ＝ X<sub>s</sub>.X<sub>1</sub>X<sub>2</sub>     X<sub>n</sub>  , [Y]<sub>s</sub> ＝ Y<sub>1</sub>   Y<sub>n</sub>， 则运算规则如下：

1. 被乘数和乘数均取绝对值参加运算， 符号位为X<sub>s</sub>异或Y<sub>s</sub>
2. 部分积的长度同被乘数， 取n + 1位， 以便存放乘法过程中绝对值大于等于1的值，初值为0 。
3. 从乘数的最低位Yn开始判断： 若Yn = 1, 则部分积加上被乘数冈， 然后右移一位；若
   Y<sub>n</sub>= 0， 则部分积加上0, 然后右移一位。
4. 重复步骤3， 判断n次。

由千乘积的数值部分是两数绝对值相乘的结果， 因此原码一位乘法运算过程中的右移操作均为逻辑右移。

设机器字长为5，一位为符号位x=-0.1101  y=0.1101

x\*=00.1101  y\*=00.1101

![Snipaste_2021-10-12_18-37-23](https://gitee.com/wang-fuming/dawning/raw/master/202110121837657.png)

##### 定点数的除法运算

### 数据的存储方式

#### 数据的大小端存储方式

大端方式按从 最高有效字节到最低有效字节的顺序存储数据， 即最高有效字节存放在前面；小端方式按从最低有效字节到最高有效字节的顺序存储数据， 即最低有效字节存放在前面。

对于数据01234567H



![Snipaste_2021-10-12_16-19-30](https://gitee.com/wang-fuming/dawning/raw/master/202110121619103.png)

相比较于十机制，左边是高位，右边是低位，大段存储方式更符合人的习惯。

#### 边界对齐

假设存储字长为32位， 可按字节、半字和字寻址。对千机器字长为32位的计绊机， 数据以边界对齐方式存放， 半字地址一定是2 的整数倍， 字地址一定是4的整数倍， 这样无论所取的数据是字节、半字还是字， 均可一次访存取出。所存储的数据不满足上述要求时， 通过填充空白字节使其符合要求。 这样虽然浪费了一些存储空间， 但可提高取指令和取数的速度。

数据不按边界对齐方式存储时， 可以充分利用存储空间， 但半字长或字长的指令可能会存储在两个存储字中， 此时需要两次访存， 并且对高低字节的位置进行调整、连接之后才能得到 所要的指令或数据， 从而影响了指令的执行效率。

# 存储系统

## 分类

### 作用

1. 主存
2. 辅存
3. 高速缓存存储器

### 介质

1. 磁表面存储器

2. 半导体存储器

3. 光盘存储器

### 存储方式

1. 随机存储器RAM

2. 只读存储器ROM

3. 串行访问存储器

### 信息可保存性

1. 易失存储器

   断电后，存储信息消失，例如RAM

2. 非易失存储器

   与上面对应，如ROM，磁表面存储器和光存储器

### 存储器性能指标

1. 存储容量=存储字数x字长(如1Mx8位)。单位换算：1B=8b，存储字数表示存储器的地址空间大小，字长表示一次存取操作的数据量。
2. 单位成本：每位价格=总成本/总容量。
3. 存储速度：数据传输率=数据的宽度/存储周期。
   1. 存取时间(Ta):存取时间是指从启动一次存储器操作到完成该操作所经历的时间，分为读出时间和写入时间。
   2. 存取周期(Tm):存取周期又称读写周期或访问周期。它是指存储器进行一次完整的读写操作所需的全部时间，即连续两次独立访问存储器操作（读或写操作）之间所需的最小时间间隔。
   3. 主存带宽(Bm):主存带宽又称数据传输率，表示每秒从主存进出信息的最大数量，单位为字/秒、字节秒(B/s)或位/秒(b/s)。

### 多级存储

![](https://gitee.com/wang-fuming/dawning/raw/master/202110102009019.png)

### 随机存储器

####  SRAM

SRAM的存取速度快，但集成度低，功耗较大，所以一般用来组成高速缓冲存储器。

#### DRAM

相对于SRAM来说，DRAM具有容易集成、位价低、容量大和功耗低等优点，但DRAM的存取速度比SRAM的慢，一般用来组成大容量主存系统。
DRAM电容上的电荷一般只能维持1~2ms,因此即使电源不断电，信息也会自动消失。为此，每隔一定时间必须刷新，通常取2ms,称为刷新周期。常用的刷新方式有3种

1. 集中刷新：指在一个刷新周期内，利用一段固定的时间，依次对存储器的所有行进行逐再生，在此期间停止对存储器的读写操作，称为“死时间”，又称访存“死区”。优点是读写操作时不受刷新工作的影响；缺点是在集中刷新期间（死区）不能访问存储器。

2. 分散刷新：把对每行的刷新分散到各个工作周期中。这样，一个存储器的系统工作周期分为两部分：前半部分用于正常读、写或保持；后半部分用于刷新。这种刷新方式增加了系统的存取周期，如存储芯片的存取周期为0.5s,则系统的存取周期为1us。优点是没有死区：缺点是加长了系统的存取周期，降低了整机的速度。

3. 异步刷新：异步刷新是前两种方法的结合，它既可缩短“死时间”，又能充分利用最大刷新间隔为2ms的特点。具体做法是将刷新周期除以行数，得到两次刷新操作之间的时间间隔，利用逻辑电路每隔时间r产生一次刷新请求。这样可以避免使CPU连续等待过长的时间，而且减少了刷新次数，从根本上提高了整机的工作效率。

|            | SRAM     | DRAM     |
| ---------- | -------- | -------- |
| 存储信息   | 触发器   | 电容     |
| 破坏性读出 | 非       | 是       |
| 需要刷新   | 不要     | 需要     |
| 送行列地址 | 同时送   | 分两次送 |
| 运行速度   | 快       | 慢       |
| 集成度     | 低       | 高       |
| 功耗       | 大       | 小       |
| 存储成本   | 高       | 低       |
| 主要用途   | 高速缓存 | 主机内存 |



#### ROM

ROM中一旦有了信息，就不能轻易改变，即使掉电也不会丢失，它在计算机系统中是只供读出的存储器。ROM器件有两个显著的优点：

1. 结构简单，所以位密度比可读写存储器的高。
2. 具有非易失性，所以可靠性高。



**ROM的类型**


1. 掩模式只读存储器MROM

   > 出厂直接写入，写入以后任何人都无法改变其内容。优点是可靠性高，集成度高，价格便宜；缺点是灵活性差

  2. 一次可编程只读存储器PROM 

     > 用户写入，一旦写入，内容就无法改变。

  3. 可擦除可编程只读存储器

     > EPROM不仅可以由用户利用编程器写入信息，而且可以对其内容进行多次改写。EPROM虽然既可读又可写，但它不能取代RAM,因为EPROM的编程次数有限，且写入时间过长。

 4. 闪速存储器( Flash Memory)

    > Flash Memory是在 EPROM与 EPROM的基础上发展起来的，其主要特点是既可在不加电的情况下长期保存信息，又能在线进行快速擦除与重写。闪速存储器既有 EPRON的价格使宜、集成度高的优点，又有 EPRON电可擦除重写的特点，且擦除重写的速度快。

 5. 固态硬盘( SSD)

    > 基于闪存的固态硬盘是用固态电子存储芯片阵列制成的硬盘，由控制单元和存储单元( FLASH芯片)组成。保留了 Flash Memory长期保存信息、快速擦除与重写的特性。对比传统硬盘也具有读写速度快、低功耗的特性，缺点是价格较高。

## 主存与CPU连接

### 连接原理

1. 主存储器通过数据总线、地址总线和控制总线与CPU连接。
2. 数据总线的位数与工作频率的乘积正比于数据传输率。
3. 地址总线的位数决定了可寻址的最大内存空间。
4. 控制总线(读/写)指出总线周期的类型和本次输入/输出操作完成的时刻。

![Snipaste_2021-10-10_20-12-12](https://gitee.com/wang-fuming/dawning/raw/master/202110102012559.png)

### 主存容量拓展

#### 位拓展

CPU 的数据线数与存储芯片的数据位数不一定相等，此时必须对存储芯片扩位（即进行位扩 展，用多个存储器件对字长进行扩充，增加存储字长），使其数据位数与CPU的数据线数相等。
位扩展的连接方式是将多个存储芯片的地址端、片选端和读写控制端相应并联，数据端分别引出。
如图3.9所示，用8片8Kxl位的RAM芯片组成8Kx8位的存储器。8片RAM芯片的地址线A12~A。、忑、 WE都分别连在一起，每片的数据线依次作为CPU数据线的一位。

#### 字拓展



# 总线

## 总线基本概念

总线就是连接各个部件的一组公共信息传输线，是各个部件共享的传输介质。分时和共享是总线的两个特点。

分时是指同一时刻只允许有一个部件向总线发送信息， 若系统中有多个部件， 则它们只能 分时地向总线发送信息。

共享是指总线上可以挂接多个部件， 各个部件之间互相交换的信息都可通过这组线路分时共享。 在某 时刻只允许有 个部件向总线发送信息， 但多个部件可同时从总线上接收相同的信息。

其优点是，总线提供一种技术标准，任何一个部件只要他的连接端按照这个标准设计就能连接到这个总线上。

## 总线的分类

### 按传输方式分类

<font size=4>**串行通信**</font>

使用一条数据线，将数据一位一位的以此传输过去，每一位数据占据一个固定的时间长度。

1. 单工模式

    只向一个方向传输数据

2. 半双工模式

     使用同一条数据线，可以进行接收和传输，但是不能同时进行

3. 全双工模式

      同时进行两个方向的传输

特点：

1. 抗干扰能力强，通信线路少，布线简便易行，施工方便，自由度及灵活度较高。

<font size=4>**并行通信**</font>

采用多为二进制数据同时通过并行线进行传输，这样的数据传输速度大大提高，但并行传输的线路长度受到限制，由于长度增加，数据也容易出错

### 按连接部位分类

<font size=4>**片内总线**</font>

在CPU内部采用，将ALU、CU和各种寄存器等部件间的互联及信息传输。

<font size=4>**系统总线**</font>

1. 数据总线DB

​        数据总线用于传输数据信息。数据总线是双向三态形式的总线。通过数据总线既可以把CPU的数据传输到存储器或I/O接口等其他部件，也可以将其他部件的数据传输到CPU。

​       数据总线的位数称为数据总线宽度，是计算机一个重要指标，通常与CPU的机器字长一致。

2. 地址总线AB

​           用来传输地址，由于地址只能只能从CPU传向存储器或I/O端口，所以地址总线是单向三态，这与数据总线不同。

​           一般来说，若地址总线为n位，则其最大可编号的地址为$2^n$个地址空间。

3. 控制总线CB

​        控制总线用来传输控制信号和时序信号。

​        

## 总线的性能指标

1. 总线的传输周期。 指 次总线操作所需的时间（包括申请阶段、 寻址阶段、 传输阶段和结束阶段）， 简称总线周期。 总线传输周期通常由若干总线时钟周期构成。
2. 总线时钟周期。 即机器的时钟周期。 计算机有一个统一的时钟，以控制整个计算机的各个部件， 总线也要受此时钟的控制。
3. 总线的工作频率。 总线上各种操作的频率， 为总线周期的倒数。 实际上指1秒内传送几次数据。 若总线周期＝N个时钟周期，则总线的工作频率＝时钟频率/N。
4)	总线的时钟频率。即机器的时钟频率，它为时钟周期的倒数。
5)	总线宽度。 又称总线位宽， 它是总线上同时能够传输的数据位数， 通常指数据总线的根 数， 如 32 根称为 32 位总线。
6)	总线带宽。 可理解为总线的数据传输率， 即单位时间内总线上可传输数据的位数， 通常 用每秒传送信息的字节数来衡量， 单位可用字节／秒(Bis)表示。 总线带宽＝总线工作 频率X（总线宽度／8）。
7. 总线复用。 总线复用是指一种信号线在不同的时间传输不同的信息， 因此可以使用较少 的线传输更多的信息， 从而节省空间和成本。
8)	信号线数。 地址总线、 数据总线和控制总线3种总线数的总 和称为信号线数。 其中， 总 线的最主要性能指标为总线宽度、 总线（工作）频率、 总线带宽， 总线带宽是指总线本身所能达到的最高传输速率， 它是衡量总线性能的重要指标。
三者关系： 总线带宽＝总线宽度X总线频率。
例如， 总线工作频率为22MHz, 总线宽度为16位， 则总线带宽＝22x(16/8) = 44MB/s。

# 指令

## 指令格式

