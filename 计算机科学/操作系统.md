# 计算机系统概述



## 操作系统基本概念



### 操作系统基本概念

操作系统(Operating System, OS)是指控制和管理整个计算机系统的硬件与软件资源， 合理地组织、调度计算机的工作与资源的分配， 进而为用户和其他软件提供方便接口与环境的程序集合。 操作系统是计算机系统中最基本的系统软件。

### 操作系统的特征

操作系统是一种系统软件，但与其他系统软件和应用软件有很大的不同，它有自己的特殊性即基本特征。 操作系统的基本特征包括并发、 共享、 虚拟和异步。

**并发**

并发是指两个或多个事件在同一时间间隔内发生。操作系统的并发性是指计算机系统中同时存在多个运行的程序， 因此它具有处理和调度多个程序同时执行的能力。 在操作系统中， 引入进程的目的是使程序能并发执行。
注意同一时间间隔（并发）和同一时刻（并行）的区别。 在多道程序环境下， 一段时间内，宏观上有多道程序在同时执行， 而在每个时刻， 单处理机环境下实际仅能有一道程序执行， 因此微观上这些程序仍是分时交替执行的。 操作系统的并发性是通过分时得以实现的。

**共享**

资源共享即共享，是指系统中的资源可供内存中多个并发执行的进程共同使用。共享可分为以下两种资源共享方式。

1. 互斥共享方式

系统中的某些资源， 如打印机、 磁带机， 虽然可供多个进程使用，但为使得所打印或记录的结果不致造成混淆， 应规定在一段时间内只允许一个进程访问该资源。

2. 同时访问方式

系统中还有另一类资源， 这类资源允许在一段时间内由多个进程 ”同时“ 访问。

 **虚拟**

虚拟是指把一个物理上的实体变为若干逻辑上的对应物。 物理实体（前者） 是实的，即实际在的；而后者是虚的，是用户感觉上的事物。 用千实现虚拟的技术，称为虚拟技术。 操作系统 中利用了多种虚拟技术来实现虚拟处理器、 虚拟内存和虚拟外部设备等。

**异步**

多道程序环境允许多个程序并发执行，但由千资源有限，进程的执行并不是一贯到底的，而是走走停停的，它以不可预知的速度向前推进，这就是进程的异步性。

异步性使得操作系统运行在一种随机的环境下，可能导致进程产生与时间有关的错误（就像对全局变量的访问顺序不当会导致程序出错一样）。 然而， 只要运行环境相同，操作系统就须保证多次运行进程后都能获得相同的结果。

### 操作系统的目标和功能

**操作系统作为计算机系统资源的管理者**

1. 处理机管理
   在多道程序环境下，处理机的分配和运行都以进程（或线程）为基本单位， 因而对处理机的管理可归结为对进程的管理。并发是指在计算机内同时运行多个进程， 因此进程何时创建、何时 撤销、如何管理、如何避免冲突、合理共享就是进程管理的最主要的任务。进程管理的主要功能包括进程控制、进程同步、进程通信、死锁处理、处理机调度等。

2. 存储器管理。

   存储器管理是为了给多道程序的运行提供良好的环境， 方便用户使用及提高内存的利用率，主要包括内存分配与回收、地址映射、 内存保护与共享和内存扩充等功能。

3. 文件管理

   计算机中的信息都是以文件的形式存在的， 操作系统中负责文件管理的部分称为文件系统。文件管理包括文件存储空间的管理、 目录管理及文件读写管理和保护等。

4. 设备管理

   设备管理的主要任务是完成用户的 I/0 请求，方便用户使用各种设备，并提高设备的利用率，主要包括缓冲管理、设备分配、设备处理和虚拟设备等功能。

**操作系统作为用户与计算机硬件系统之间的接口**

1. 命令接口

   1. 联机命令接口又称交互式命令接口，适用千分时或实时系统的接口。它由一组键盘操作命令 组成。用户通过控制台或终端输入操作命令， 向系统提出各种服务要求。用户每输入一条命令，控制权就转给操作系统的命令解释程序， 然后由命令解释程序解释并执行输入的命令， 完成指定的功能。之后， 控制权转回控制台或终端， 此时用户又可输入下一条命令。联机命令接口可以这样理解： “雇主” 说一句话， “工人“ 做一件事， 并做出反馈， 这就强调了交互性。
   2. 脱机命令接口又称批处理命令接口， 适用千批处理系统， 它由一组作业控制命令组成。脱机 用户不能直接干预作业的运行， 而应事先用相应的作业控制命令写成一份作业操作说明书， 连同 作业一起提交给系统。系统调度到该作业时， 由系统中的命令解释程序逐条解释执行作业说明书上的命令， 从而间接地控制作业的运行。脱机命令接口可以这样理解： “雇主” 把要 “工人“ 做的事写在清单上，“工人” 按照清单命令逐条完成这些事， 这就是批处理。

2. 程序接口

   程序接口由一组系统调用（也称广义指令）组成。用户通过在程序中使用这些系统调用来请求操作系统为其提供服务， 如使用各种外部设备、 申请分配和回收内存及其他各种要求。
   当前最为流行的是图形用户界面 (GUI)，即图形接口。GUI 最终是通过调用程序接口实现的，用户通过鼠标和键盘在图形界面上单击或使用快捷键， 就能很方便地使用操作系统。严格来说，图形接口不是操作系统的一部分， 但图形接口所调用的系统调用命令是操作系统的一部分。

**操作系统用作扩充机器**

没有任何软件支持的计算机称为裸机， 它仅构成计算机系统的物质基础， 而实际呈现在用户面前的计算机系统是经过若干层软件改造的计算机。 裸机在最里层， 其外面是操作系统。 操作系 统所提供的资源管理功能和方便用户的各种服务功能， 将裸机改造成功能更强、 使用更方便的机 器； 因此， 我们通常把稷盖了软件的机器称为扩充机器或虚拟机。

# 进程管理

## 概念

对于操作系统来说，一个任务就是一个进程（Process）。
课本概念：程序的一个执行实例，正在执行的程序等。
内核观点：担当分配系统资源（CPU时间，内存）的实体。
如何理解进程?
如：张三去银行转账，就要使用银行的资源（接待，转账人员，银行电脑，必要时保安也可以跟着:) ）为张三完成转账,而在银行内部，这一整套过程的执行，我们统称为办理业务。类比，一个程序刚开始就是一个在硬盘上的程序，加载运行时，是为了完成某些任务（如迅雷完成下载任务），而要完成任务，就需要操作系统为该任务提供足够做的资源（如内存和CPU资源），而这一整套任务的执行，我们可以叫做进程
所以：进程是担当分配系统资源（CPU时间，内存）的实体，是具有动态特性的，如张三在办理转账业务期间，这样任务一直都是存在且状态变更的。

而张三去银行转账也不是立马就能进行，需要先抽号，在大厅等待，因为当时可能会有很多人在大厅等待，所以就有了进程等待队列。而张三抽到的号，可以称之为进程ID

## 时间片

现代操作系统比如Mac OS X，UNIX，Linux，Windows等，都是支持“多任务”的操作系统。所谓的多任务，就是操作系统可以同时运行多个任务。
操作系统（如Windows、Linux）的任务调度是采用时间片轮转的抢占式调度方式，也就是说一个任务执行一小段时间后强制暂停去执行下一个任务，每个任务轮流执行。
任务执行的一小段时间叫做时间片，任务正在执行时的状态叫运行状态，任务执行一段时间后强制暂停去执行下一个任务，被暂停的任务就处于就绪状态等待下一个属于它的时间片的到来。

这样每个任务都能得到执行，由于CPU的执行效率非常高，时间片非常短，在各个任务之间快速地切换，给人的感觉就是多个任务在“同时进行”，这也就是我们所说的并发。
如何理解?
假设张三准备办理转账业务，但当他把所有资料给工作人员之后，工作人员告诉他，你现在办理不了，因为他现在需要填写一张申请表，此时，工作人员将他的资料保存起来，让他去一边填写资料，填写完毕之后，再回来继续办理，同时，张三去填表了，而工作人员继续给别人提供服务。这个过程叫做进程切换。
张三表填完了，继续回到柜台，工作人员拿出他之前的资料，继续给张三办理业务，这叫做进程的上下文保护与恢复（想想，为什么要这麽做？因为进程的运行是在CPU上的，CPU有寄存器，保存的是进程运行的各种临时数据，为了达到切换和便于恢复的目的，就有了将CPU寄存器保存和恢复的做法，归根结底是为了接着上次的位置继续运行）后来，银行出台了规定，每个人在柜台办理任务的时间不能超过10分钟（以防止其他人长时间等待），所以为了更好的服务各个人员，银行工作人员将上面的切换与恢复的思路应用到各种业务中，所以长期来看，即便只有一个工作人员，也能同时服务多个客户，这种机制叫做基于时间片的进程轮转管理机制，而上面的10分钟，就是银行轮转的时间片，只要时间到了，客户酒的下去等待，让其他用户来办理业务而上面的所有轮转与管理工作，在操作系统中，统一由一个叫做调度器的内核模块完成而对每个人来说，在一段时间之内，可能所有人的业务都得以推进（即便没完成），而不至于大家长时间等待，这种机制就叫做并发
如果银行财大气粗，工作人员比客户都多，那就好办了，一人一个工作人员，所有的任务真正同时处理，这种机制叫做并行。
下面，我们来看看并发和并行的详细概念

## 并发和并行

现在，多核CPU已经非常普及了，由于任务数量远远多于CPU的核心数量，所以，操作系统也会自动把很多任务轮流调度到每个核心上执行。对于
并发：多个进程在一个CPU下采用时间片轮转的方式，在一段时间之内，让多个进程都得以推进，称之为并
发。
并行：多个进程在多个CPU下分别，同时进行运行，这称之为并行。
计算机操作系统中把并行性和并发性明显区分开，主要是从微观的角度来说的，具体是指进程的并行性（多处理机的情况下，多个进程同时运行）和并发性（单处理机的情况下，多个进程在同一时间间隔运行的）。
并发与并行类似于工厂中的流水线，要扩大产量，1是考虑建造多个工厂，这就是并行，2是考虑每个工厂中新增流水线，这就类似并发。

## 内核态与用户态

一般的操作系统（如Windows、Linux）对执行权限进行分级：用户态和内核态。
如上图所示，操作系统内核作为直接控制硬件设备的底层软件，权限最高，称为内核态，或核心态。
用户程序的权限最低，称为用户态。
如何理解？
就好比上面的例子，张三去填表，自己写姓名，电话，邮箱等等，做着自己的事情，这叫做用户态
而张三通过窗口的工作人员，把自己的需求给工作人员，自此，张三在等，银行工作人员在忙，对张三来讲，就叫做陷入内核。那么内核态是什么意思？就是工作人员在帮你办理业务时的状态

## 进程中的上下文

上下文简单说来就是一个环境，进程在时间片轮转切换时，由于每个进程运行环境不同，就涉及到转换前后的上下文环境的切换就是一个进程在执行的时候，CPU的所有寄存器中的值、进程的状态以及堆栈上的内容。
切换时需要保存当前进程的所有状态，即保存当前进程的进程上下文，以便再次执行该进程时，能够恢复切换
时的状态，继续执行。

## 进程状态

![image-20220104195928852](https://gitee.com/wang-fuming/dawning/raw/master/img/202201041959794.png)

就绪：进程处于可运行的状态，只是CPU时间片还没有轮转到该进程，则该进程处于就绪状态。
运行：进程处于可运行的状态，且CPU时间片轮转到该进程，该进程正在执行代码，则该进程处于运行状态。
阻塞：进程不具备运行条件，正在等待某个事件的完成。
可以对比张三去银行办理业务的状态

# 内存管理



# 文件管理



# I/O管理

